#include <assert.h>
#include "Fixie/Num.h"
#include "Fixie/Util.h"
#include "Fixie/Trig.h"

namespace Fixie {
  namespace Trig {
    const Num pi = Num::createByRaw(51472);
    const Num twoPi = Num::createByRaw(102944);
    const Num halfPi = Num::createByRaw(25736);
    const Num inverseTwoPi = Num::createByRaw(2608);

    int16_t sineTable[] = {
      0, 101, 201, 302, 402, 503, 603, 704,
      804, 904, 1005, 1105, 1205, 1306, 1406, 1506,
      1606, 1706, 1806, 1906, 2006, 2105, 2205, 2305,
      2404, 2503, 2603, 2702, 2801, 2900, 2999, 3098,
      3196, 3295, 3393, 3492, 3590, 3688, 3786, 3883,
      3981, 4078, 4176, 4273, 4370, 4467, 4563, 4660,
      4756, 4852, 4948, 5044, 5139, 5235, 5330, 5425,
      5520, 5614, 5708, 5803, 5897, 5990, 6084, 6177,
      6270, 6363, 6455, 6547, 6639, 6731, 6823, 6914,
      7005, 7096, 7186, 7276, 7366, 7456, 7545, 7635,
      7723, 7812, 7900, 7988, 8076, 8163, 8250, 8337,
      8423, 8509, 8595, 8680, 8765, 8850, 8935, 9019,
      9102, 9186, 9269, 9352, 9434, 9516, 9598, 9679,
      9760, 9841, 9921, 10001, 10080, 10159, 10238, 10316,
      10394, 10471, 10549, 10625, 10702, 10778, 10853, 10928,
      11003, 11077, 11151, 11224, 11297, 11370, 11442, 11514,
      11585, 11656, 11727, 11797, 11866, 11935, 12004, 12072,
      12140, 12207, 12274, 12340, 12406, 12472, 12537, 12601,
      12665, 12729, 12792, 12854, 12916, 12978, 13039, 13100,
      13160, 13219, 13279, 13337, 13395, 13453, 13510, 13567,
      13623, 13678, 13733, 13788, 13842, 13896, 13949, 14001,
      14053, 14104, 14155, 14206, 14256, 14305, 14354, 14402,
      14449, 14497, 14543, 14589, 14635, 14680, 14724, 14768,
      14811, 14854, 14896, 14937, 14978, 15019, 15059, 15098,
      15137, 15175, 15213, 15250, 15286, 15322, 15357, 15392,
      15426, 15460, 15493, 15525, 15557, 15588, 15619, 15649,
      15679, 15707, 15736, 15763, 15791, 15817, 15843, 15868,
      15893, 15917, 15941, 15964, 15986, 16008, 16029, 16049,
      16069, 16088, 16107, 16125, 16143, 16160, 16176, 16192,
      16207, 16221, 16235, 16248, 16261, 16273, 16284, 16295,
      16305, 16315, 16324, 16332, 16340, 16347, 16353, 16359,
      16364, 16369, 16373, 16376, 16379, 16381, 16383, 16384,
      16384, 16384, 16383, 16381, 16379, 16376, 16373, 16369,
      16364, 16359, 16353, 16347, 16340, 16332, 16324, 16315,
      16305, 16295, 16284, 16273, 16261, 16248, 16235, 16221,
      16207, 16192, 16176, 16160, 16143, 16125, 16107, 16088,
      16069, 16049, 16029, 16008, 15986, 15964, 15941, 15917,
      15893, 15868, 15843, 15817, 15791, 15763, 15736, 15707,
      15679, 15649, 15619, 15588, 15557, 15525, 15493, 15460,
      15426, 15392, 15357, 15322, 15286, 15250, 15213, 15175,
      15137, 15098, 15059, 15019, 14978, 14937, 14896, 14854,
      14811, 14768, 14724, 14680, 14635, 14589, 14543, 14497,
      14449, 14402, 14354, 14305, 14256, 14206, 14155, 14104,
      14053, 14001, 13949, 13896, 13842, 13788, 13733, 13678,
      13623, 13567, 13510, 13453, 13395, 13337, 13279, 13219,
      13160, 13100, 13039, 12978, 12916, 12854, 12792, 12729,
      12665, 12601, 12537, 12472, 12406, 12340, 12274, 12207,
      12140, 12072, 12004, 11935, 11866, 11797, 11727, 11656,
      11585, 11514, 11442, 11370, 11297, 11224, 11151, 11077,
      11003, 10928, 10853, 10778, 10702, 10625, 10549, 10471,
      10394, 10316, 10238, 10159, 10080, 10001, 9921, 9841,
      9760, 9679, 9598, 9516, 9434, 9352, 9269, 9186,
      9102, 9019, 8935, 8850, 8765, 8680, 8595, 8509,
      8423, 8337, 8250, 8163, 8076, 7988, 7900, 7812,
      7723, 7635, 7545, 7456, 7366, 7276, 7186, 7096,
      7005, 6914, 6823, 6731, 6639, 6547, 6455, 6363,
      6270, 6177, 6084, 5990, 5897, 5803, 5708, 5614,
      5520, 5425, 5330, 5235, 5139, 5044, 4948, 4852,
      4756, 4660, 4563, 4467, 4370, 4273, 4176, 4078,
      3981, 3883, 3786, 3688, 3590, 3492, 3393, 3295,
      3196, 3098, 2999, 2900, 2801, 2702, 2603, 2503,
      2404, 2305, 2205, 2105, 2006, 1906, 1806, 1706,
      1606, 1506, 1406, 1306, 1205, 1105, 1005, 904,
      804, 704, 603, 503, 402, 302, 201, 101,
      0, -101, -201, -302, -402, -503, -603, -704,
      -804, -904, -1005, -1105, -1205, -1306, -1406, -1506,
      -1606, -1706, -1806, -1906, -2006, -2105, -2205, -2305,
      -2404, -2503, -2603, -2702, -2801, -2900, -2999, -3098,
      -3196, -3295, -3393, -3492, -3590, -3688, -3786, -3883,
      -3981, -4078, -4176, -4273, -4370, -4467, -4563, -4660,
      -4756, -4852, -4948, -5044, -5139, -5235, -5330, -5425,
      -5520, -5614, -5708, -5803, -5897, -5990, -6084, -6177,
      -6270, -6363, -6455, -6547, -6639, -6731, -6823, -6914,
      -7005, -7096, -7186, -7276, -7366, -7456, -7545, -7635,
      -7723, -7812, -7900, -7988, -8076, -8163, -8250, -8337,
      -8423, -8509, -8595, -8680, -8765, -8850, -8935, -9019,
      -9102, -9186, -9269, -9352, -9434, -9516, -9598, -9679,
      -9760, -9841, -9921, -10001, -10080, -10159, -10238, -10316,
      -10394, -10471, -10549, -10625, -10702, -10778, -10853, -10928,
      -11003, -11077, -11151, -11224, -11297, -11370, -11442, -11514,
      -11585, -11656, -11727, -11797, -11866, -11935, -12004, -12072,
      -12140, -12207, -12274, -12340, -12406, -12472, -12537, -12601,
      -12665, -12729, -12792, -12854, -12916, -12978, -13039, -13100,
      -13160, -13219, -13279, -13337, -13395, -13453, -13510, -13567,
      -13623, -13678, -13733, -13788, -13842, -13896, -13949, -14001,
      -14053, -14104, -14155, -14206, -14256, -14305, -14354, -14402,
      -14449, -14497, -14543, -14589, -14635, -14680, -14724, -14768,
      -14811, -14854, -14896, -14937, -14978, -15019, -15059, -15098,
      -15137, -15175, -15213, -15250, -15286, -15322, -15357, -15392,
      -15426, -15460, -15493, -15525, -15557, -15588, -15619, -15649,
      -15679, -15707, -15736, -15763, -15791, -15817, -15843, -15868,
      -15893, -15917, -15941, -15964, -15986, -16008, -16029, -16049,
      -16069, -16088, -16107, -16125, -16143, -16160, -16176, -16192,
      -16207, -16221, -16235, -16248, -16261, -16273, -16284, -16295,
      -16305, -16315, -16324, -16332, -16340, -16347, -16353, -16359,
      -16364, -16369, -16373, -16376, -16379, -16381, -16383, -16384,
      -16384, -16384, -16383, -16381, -16379, -16376, -16373, -16369,
      -16364, -16359, -16353, -16347, -16340, -16332, -16324, -16315,
      -16305, -16295, -16284, -16273, -16261, -16248, -16235, -16221,
      -16207, -16192, -16176, -16160, -16143, -16125, -16107, -16088,
      -16069, -16049, -16029, -16008, -15986, -15964, -15941, -15917,
      -15893, -15868, -15843, -15817, -15791, -15763, -15736, -15707,
      -15679, -15649, -15619, -15588, -15557, -15525, -15493, -15460,
      -15426, -15392, -15357, -15322, -15286, -15250, -15213, -15175,
      -15137, -15098, -15059, -15019, -14978, -14937, -14896, -14854,
      -14811, -14768, -14724, -14680, -14635, -14589, -14543, -14497,
      -14449, -14402, -14354, -14305, -14256, -14206, -14155, -14104,
      -14053, -14001, -13949, -13896, -13842, -13788, -13733, -13678,
      -13623, -13567, -13510, -13453, -13395, -13337, -13279, -13219,
      -13160, -13100, -13039, -12978, -12916, -12854, -12792, -12729,
      -12665, -12601, -12537, -12472, -12406, -12340, -12274, -12207,
      -12140, -12072, -12004, -11935, -11866, -11797, -11727, -11656,
      -11585, -11514, -11442, -11370, -11297, -11224, -11151, -11077,
      -11003, -10928, -10853, -10778, -10702, -10625, -10549, -10471,
      -10394, -10316, -10238, -10159, -10080, -10001, -9921, -9841,
      -9760, -9679, -9598, -9516, -9434, -9352, -9269, -9186,
      -9102, -9019, -8935, -8850, -8765, -8680, -8595, -8509,
      -8423, -8337, -8250, -8163, -8076, -7988, -7900, -7812,
      -7723, -7635, -7545, -7456, -7366, -7276, -7186, -7096,
      -7005, -6914, -6823, -6731, -6639, -6547, -6455, -6363,
      -6270, -6177, -6084, -5990, -5897, -5803, -5708, -5614,
      -5520, -5425, -5330, -5235, -5139, -5044, -4948, -4852,
      -4756, -4660, -4563, -4467, -4370, -4273, -4176, -4078,
      -3981, -3883, -3786, -3688, -3590, -3492, -3393, -3295,
      -3196, -3098, -2999, -2900, -2801, -2702, -2603, -2503,
      -2404, -2305, -2205, -2105, -2006, -1906, -1806, -1706,
      -1606, -1506, -1406, -1306, -1205, -1105, -1005, -904,
      -804, -704, -603, -503, -402, -302, -201, -101
    };

    int16_t cosineTable[] = {
      16384, 16384, 16383, 16381, 16379, 16376, 16373, 16369,
      16364, 16359, 16353, 16347, 16340, 16332, 16324, 16315,
      16305, 16295, 16284, 16273, 16261, 16248, 16235, 16221,
      16207, 16192, 16176, 16160, 16143, 16125, 16107, 16088,
      16069, 16049, 16029, 16008, 15986, 15964, 15941, 15917,
      15893, 15868, 15843, 15817, 15791, 15763, 15736, 15707,
      15679, 15649, 15619, 15588, 15557, 15525, 15493, 15460,
      15426, 15392, 15357, 15322, 15286, 15250, 15213, 15175,
      15137, 15098, 15059, 15019, 14978, 14937, 14896, 14854,
      14811, 14768, 14724, 14680, 14635, 14589, 14543, 14497,
      14449, 14402, 14354, 14305, 14256, 14206, 14155, 14104,
      14053, 14001, 13949, 13896, 13842, 13788, 13733, 13678,
      13623, 13567, 13510, 13453, 13395, 13337, 13279, 13219,
      13160, 13100, 13039, 12978, 12916, 12854, 12792, 12729,
      12665, 12601, 12537, 12472, 12406, 12340, 12274, 12207,
      12140, 12072, 12004, 11935, 11866, 11797, 11727, 11656,
      11585, 11514, 11442, 11370, 11297, 11224, 11151, 11077,
      11003, 10928, 10853, 10778, 10702, 10625, 10549, 10471,
      10394, 10316, 10238, 10159, 10080, 10001, 9921, 9841,
      9760, 9679, 9598, 9516, 9434, 9352, 9269, 9186,
      9102, 9019, 8935, 8850, 8765, 8680, 8595, 8509,
      8423, 8337, 8250, 8163, 8076, 7988, 7900, 7812,
      7723, 7635, 7545, 7456, 7366, 7276, 7186, 7096,
      7005, 6914, 6823, 6731, 6639, 6547, 6455, 6363,
      6270, 6177, 6084, 5990, 5897, 5803, 5708, 5614,
      5520, 5425, 5330, 5235, 5139, 5044, 4948, 4852,
      4756, 4660, 4563, 4467, 4370, 4273, 4176, 4078,
      3981, 3883, 3786, 3688, 3590, 3492, 3393, 3295,
      3196, 3098, 2999, 2900, 2801, 2702, 2603, 2503,
      2404, 2305, 2205, 2105, 2006, 1906, 1806, 1706,
      1606, 1506, 1406, 1306, 1205, 1105, 1005, 904,
      804, 704, 603, 503, 402, 302, 201, 101,
      0, -101, -201, -302, -402, -503, -603, -704,
      -804, -904, -1005, -1105, -1205, -1306, -1406, -1506,
      -1606, -1706, -1806, -1906, -2006, -2105, -2205, -2305,
      -2404, -2503, -2603, -2702, -2801, -2900, -2999, -3098,
      -3196, -3295, -3393, -3492, -3590, -3688, -3786, -3883,
      -3981, -4078, -4176, -4273, -4370, -4467, -4563, -4660,
      -4756, -4852, -4948, -5044, -5139, -5235, -5330, -5425,
      -5520, -5614, -5708, -5803, -5897, -5990, -6084, -6177,
      -6270, -6363, -6455, -6547, -6639, -6731, -6823, -6914,
      -7005, -7096, -7186, -7276, -7366, -7456, -7545, -7635,
      -7723, -7812, -7900, -7988, -8076, -8163, -8250, -8337,
      -8423, -8509, -8595, -8680, -8765, -8850, -8935, -9019,
      -9102, -9186, -9269, -9352, -9434, -9516, -9598, -9679,
      -9760, -9841, -9921, -10001, -10080, -10159, -10238, -10316,
      -10394, -10471, -10549, -10625, -10702, -10778, -10853, -10928,
      -11003, -11077, -11151, -11224, -11297, -11370, -11442, -11514,
      -11585, -11656, -11727, -11797, -11866, -11935, -12004, -12072,
      -12140, -12207, -12274, -12340, -12406, -12472, -12537, -12601,
      -12665, -12729, -12792, -12854, -12916, -12978, -13039, -13100,
      -13160, -13219, -13279, -13337, -13395, -13453, -13510, -13567,
      -13623, -13678, -13733, -13788, -13842, -13896, -13949, -14001,
      -14053, -14104, -14155, -14206, -14256, -14305, -14354, -14402,
      -14449, -14497, -14543, -14589, -14635, -14680, -14724, -14768,
      -14811, -14854, -14896, -14937, -14978, -15019, -15059, -15098,
      -15137, -15175, -15213, -15250, -15286, -15322, -15357, -15392,
      -15426, -15460, -15493, -15525, -15557, -15588, -15619, -15649,
      -15679, -15707, -15736, -15763, -15791, -15817, -15843, -15868,
      -15893, -15917, -15941, -15964, -15986, -16008, -16029, -16049,
      -16069, -16088, -16107, -16125, -16143, -16160, -16176, -16192,
      -16207, -16221, -16235, -16248, -16261, -16273, -16284, -16295,
      -16305, -16315, -16324, -16332, -16340, -16347, -16353, -16359,
      -16364, -16369, -16373, -16376, -16379, -16381, -16383, -16384,
      -16384, -16384, -16383, -16381, -16379, -16376, -16373, -16369,
      -16364, -16359, -16353, -16347, -16340, -16332, -16324, -16315,
      -16305, -16295, -16284, -16273, -16261, -16248, -16235, -16221,
      -16207, -16192, -16176, -16160, -16143, -16125, -16107, -16088,
      -16069, -16049, -16029, -16008, -15986, -15964, -15941, -15917,
      -15893, -15868, -15843, -15817, -15791, -15763, -15736, -15707,
      -15679, -15649, -15619, -15588, -15557, -15525, -15493, -15460,
      -15426, -15392, -15357, -15322, -15286, -15250, -15213, -15175,
      -15137, -15098, -15059, -15019, -14978, -14937, -14896, -14854,
      -14811, -14768, -14724, -14680, -14635, -14589, -14543, -14497,
      -14449, -14402, -14354, -14305, -14256, -14206, -14155, -14104,
      -14053, -14001, -13949, -13896, -13842, -13788, -13733, -13678,
      -13623, -13567, -13510, -13453, -13395, -13337, -13279, -13219,
      -13160, -13100, -13039, -12978, -12916, -12854, -12792, -12729,
      -12665, -12601, -12537, -12472, -12406, -12340, -12274, -12207,
      -12140, -12072, -12004, -11935, -11866, -11797, -11727, -11656,
      -11585, -11514, -11442, -11370, -11297, -11224, -11151, -11077,
      -11003, -10928, -10853, -10778, -10702, -10625, -10549, -10471,
      -10394, -10316, -10238, -10159, -10080, -10001, -9921, -9841,
      -9760, -9679, -9598, -9516, -9434, -9352, -9269, -9186,
      -9102, -9019, -8935, -8850, -8765, -8680, -8595, -8509,
      -8423, -8337, -8250, -8163, -8076, -7988, -7900, -7812,
      -7723, -7635, -7545, -7456, -7366, -7276, -7186, -7096,
      -7005, -6914, -6823, -6731, -6639, -6547, -6455, -6363,
      -6270, -6177, -6084, -5990, -5897, -5803, -5708, -5614,
      -5520, -5425, -5330, -5235, -5139, -5044, -4948, -4852,
      -4756, -4660, -4563, -4467, -4370, -4273, -4176, -4078,
      -3981, -3883, -3786, -3688, -3590, -3492, -3393, -3295,
      -3196, -3098, -2999, -2900, -2801, -2702, -2603, -2503,
      -2404, -2305, -2205, -2105, -2006, -1906, -1806, -1706,
      -1606, -1506, -1406, -1306, -1205, -1105, -1005, -904,
      -804, -704, -603, -503, -402, -302, -201, -101,
      0, 101, 201, 302, 402, 503, 603, 704,
      804, 904, 1005, 1105, 1205, 1306, 1406, 1506,
      1606, 1706, 1806, 1906, 2006, 2105, 2205, 2305,
      2404, 2503, 2603, 2702, 2801, 2900, 2999, 3098,
      3196, 3295, 3393, 3492, 3590, 3688, 3786, 3883,
      3981, 4078, 4176, 4273, 4370, 4467, 4563, 4660,
      4756, 4852, 4948, 5044, 5139, 5235, 5330, 5425,
      5520, 5614, 5708, 5803, 5897, 5990, 6084, 6177,
      6270, 6363, 6455, 6547, 6639, 6731, 6823, 6914,
      7005, 7096, 7186, 7276, 7366, 7456, 7545, 7635,
      7723, 7812, 7900, 7988, 8076, 8163, 8250, 8337,
      8423, 8509, 8595, 8680, 8765, 8850, 8935, 9019,
      9102, 9186, 9269, 9352, 9434, 9516, 9598, 9679,
      9760, 9841, 9921, 10001, 10080, 10159, 10238, 10316,
      10394, 10471, 10549, 10625, 10702, 10778, 10853, 10928,
      11003, 11077, 11151, 11224, 11297, 11370, 11442, 11514,
      11585, 11656, 11727, 11797, 11866, 11935, 12004, 12072,
      12140, 12207, 12274, 12340, 12406, 12472, 12537, 12601,
      12665, 12729, 12792, 12854, 12916, 12978, 13039, 13100,
      13160, 13219, 13279, 13337, 13395, 13453, 13510, 13567,
      13623, 13678, 13733, 13788, 13842, 13896, 13949, 14001,
      14053, 14104, 14155, 14206, 14256, 14305, 14354, 14402,
      14449, 14497, 14543, 14589, 14635, 14680, 14724, 14768,
      14811, 14854, 14896, 14937, 14978, 15019, 15059, 15098,
      15137, 15175, 15213, 15250, 15286, 15322, 15357, 15392,
      15426, 15460, 15493, 15525, 15557, 15588, 15619, 15649,
      15679, 15707, 15736, 15763, 15791, 15817, 15843, 15868,
      15893, 15917, 15941, 15964, 15986, 16008, 16029, 16049,
      16069, 16088, 16107, 16125, 16143, 16160, 16176, 16192,
      16207, 16221, 16235, 16248, 16261, 16273, 16284, 16295,
      16305, 16315, 16324, 16332, 16340, 16347, 16353, 16359,
      16364, 16369, 16373, 16376, 16379, 16381, 16383, 16384
    };

    uint16_t arcCosineTable[] = {
      51472, 50448, 50023, 49697, 49423, 49180, 48961, 48760,
      48572, 48395, 48228, 48070, 47918, 47772, 47632, 47496,
      47365, 47238, 47115, 46994, 46877, 46763, 46652, 46542,
      46435, 46331, 46228, 46127, 46028, 45931, 45835, 45741,
      45649, 45557, 45467, 45379, 45291, 45205, 45120, 45036,
      44953, 44870, 44789, 44709, 44630, 44551, 44474, 44397,
      44321, 44245, 44171, 44097, 44024, 43951, 43879, 43808,
      43737, 43667, 43598, 43529, 43460, 43393, 43325, 43258,
      43192, 43126, 43061, 42996, 42931, 42867, 42804, 42741,
      42678, 42615, 42553, 42492, 42431, 42370, 42309, 42249,
      42189, 42130, 42071, 42012, 41953, 41895, 41837, 41780,
      41723, 41666, 41609, 41553, 41497, 41441, 41385, 41330,
      41275, 41220, 41166, 41111, 41057, 41004, 40950, 40897,
      40844, 40791, 40738, 40686, 40634, 40582, 40530, 40478,
      40427, 40376, 40325, 40274, 40223, 40173, 40123, 40073,
      40023, 39973, 39924, 39875, 39825, 39776, 39728, 39679,
      39631, 39582, 39534, 39486, 39438, 39391, 39343, 39296,
      39249, 39201, 39155, 39108, 39061, 39015, 38968, 38922,
      38876, 38830, 38784, 38738, 38693, 38647, 38602, 38557,
      38512, 38467, 38422, 38377, 38333, 38288, 38244, 38200,
      38156, 38112, 38068, 38024, 37980, 37937, 37893, 37850,
      37807, 37763, 37720, 37677, 37635, 37592, 37549, 37507,
      37464, 37422, 37380, 37337, 37295, 37253, 37211, 37170,
      37128, 37086, 37045, 37003, 36962, 36921, 36879, 36838,
      36797, 36756, 36715, 36675, 36634, 36593, 36553, 36512,
      36472, 36432, 36391, 36351, 36311, 36271, 36231, 36191,
      36151, 36112, 36072, 36032, 35993, 35953, 35914, 35875,
      35835, 35796, 35757, 35718, 35679, 35640, 35601, 35563,
      35524, 35485, 35447, 35408, 35370, 35331, 35293, 35254,
      35216, 35178, 35140, 35102, 35064, 35026, 34988, 34950,
      34912, 34874, 34837, 34799, 34762, 34724, 34687, 34649,
      34612, 34574, 34537, 34500, 34463, 34426, 34389, 34352,
      34315, 34278, 34241, 34204, 34167, 34130, 34094, 34057,
      34020, 33984, 33947, 33911, 33875, 33838, 33802, 33766,
      33729, 33693, 33657, 33621, 33585, 33549, 33513, 33477,
      33441, 33405, 33369, 33333, 33298, 33262, 33226, 33190,
      33155, 33119, 33084, 33048, 33013, 32977, 32942, 32907,
      32871, 32836, 32801, 32766, 32730, 32695, 32660, 32625,
      32590, 32555, 32520, 32485, 32450, 32415, 32381, 32346,
      32311, 32276, 32242, 32207, 32172, 32138, 32103, 32068,
      32034, 31999, 31965, 31930, 31896, 31862, 31827, 31793,
      31759, 31724, 31690, 31656, 31622, 31588, 31553, 31519,
      31485, 31451, 31417, 31383, 31349, 31315, 31281, 31247,
      31213, 31180, 31146, 31112, 31078, 31044, 31011, 30977,
      30943, 30909, 30876, 30842, 30809, 30775, 30741, 30708,
      30674, 30641, 30607, 30574, 30540, 30507, 30474, 30440,
      30407, 30374, 30340, 30307, 30274, 30240, 30207, 30174,
      30141, 30108, 30074, 30041, 30008, 29975, 29942, 29909,
      29876, 29843, 29810, 29777, 29744, 29711, 29678, 29645,
      29612, 29579, 29546, 29513, 29480, 29448, 29415, 29382,
      29349, 29316, 29284, 29251, 29218, 29185, 29153, 29120,
      29087, 29055, 29022, 28989, 28957, 28924, 28891, 28859,
      28826, 28794, 28761, 28729, 28696, 28663, 28631, 28598,
      28566, 28534, 28501, 28469, 28436, 28404, 28371, 28339,
      28306, 28274, 28242, 28209, 28177, 28145, 28112, 28080,
      28048, 28015, 27983, 27951, 27918, 27886, 27854, 27822,
      27789, 27757, 27725, 27693, 27660, 27628, 27596, 27564,
      27532, 27499, 27467, 27435, 27403, 27371, 27338, 27306,
      27274, 27242, 27210, 27178, 27146, 27114, 27081, 27049,
      27017, 26985, 26953, 26921, 26889, 26857, 26825, 26793,
      26761, 26729, 26696, 26664, 26632, 26600, 26568, 26536,
      26504, 26472, 26440, 26408, 26376, 26344, 26312, 26280,
      26248, 26216, 26184, 26152, 26120, 26088, 26056, 26024,
      25992, 25960, 25928, 25896, 25864, 25832, 25800, 25768,
      25736, 25704, 25672, 25640, 25608, 25576, 25544, 25512,
      25480, 25448, 25416, 25384, 25352, 25320, 25288, 25256,
      25224, 25192, 25160, 25128, 25096, 25064, 25032, 25000,
      24968, 24936, 24904, 24872, 24839, 24807, 24775, 24743,
      24711, 24679, 24647, 24615, 24583, 24551, 24519, 24487,
      24455, 24423, 24390, 24358, 24326, 24294, 24262, 24230,
      24198, 24166, 24133, 24101, 24069, 24037, 24005, 23973,
      23940, 23908, 23876, 23844, 23812, 23779, 23747, 23715,
      23683, 23650, 23618, 23586, 23553, 23521, 23489, 23457,
      23424, 23392, 23360, 23327, 23295, 23263, 23230, 23198,
      23165, 23133, 23101, 23068, 23036, 23003, 22971, 22938,
      22906, 22873, 22841, 22808, 22776, 22743, 22711, 22678,
      22646, 22613, 22580, 22548, 22515, 22483, 22450, 22417,
      22385, 22352, 22319, 22287, 22254, 22221, 22188, 22155,
      22123, 22090, 22057, 22024, 21991, 21959, 21926, 21893,
      21860, 21827, 21794, 21761, 21728, 21695, 21662, 21629,
      21596, 21563, 21530, 21497, 21464, 21431, 21397, 21364,
      21331, 21298, 21265, 21231, 21198, 21165, 21132, 21098,
      21065, 21032, 20998, 20965, 20931, 20898, 20864, 20831,
      20797, 20764, 20730, 20697, 20663, 20630, 20596, 20562,
      20529, 20495, 20461, 20428, 20394, 20360, 20326, 20292,
      20258, 20225, 20191, 20157, 20123, 20089, 20055, 20021,
      19987, 19953, 19918, 19884, 19850, 19816, 19782, 19747,
      19713, 19679, 19645, 19610, 19576, 19541, 19507, 19472,
      19438, 19403, 19369, 19334, 19300, 19265, 19230, 19196,
      19161, 19126, 19091, 19056, 19022, 18987, 18952, 18917,
      18882, 18847, 18812, 18777, 18741, 18706, 18671, 18636,
      18600, 18565, 18530, 18494, 18459, 18424, 18388, 18353,
      18317, 18281, 18246, 18210, 18174, 18139, 18103, 18067,
      18031, 17995, 17959, 17923, 17887, 17851, 17815, 17779,
      17743, 17706, 17670, 17634, 17597, 17561, 17524, 17488,
      17451, 17415, 17378, 17341, 17305, 17268, 17231, 17194,
      17157, 17120, 17083, 17046, 17009, 16972, 16935, 16897,
      16860, 16823, 16785, 16748, 16710, 16673, 16635, 16597,
      16560, 16522, 16484, 16446, 16408, 16370, 16332, 16294,
      16256, 16217, 16179, 16141, 16102, 16064, 16025, 15987,
      15948, 15909, 15870, 15832, 15793, 15754, 15715, 15676,
      15636, 15597, 15558, 15518, 15479, 15439, 15400, 15360,
      15320, 15281, 15241, 15201, 15161, 15121, 15081, 15040,
      15000, 14960, 14919, 14879, 14838, 14797, 14756, 14716,
      14675, 14634, 14592, 14551, 14510, 14469, 14427, 14386,
      14344, 14302, 14260, 14219, 14177, 14134, 14092, 14050,
      14008, 13965, 13923, 13880, 13837, 13794, 13751, 13708,
      13665, 13622, 13579, 13535, 13492, 13448, 13404, 13360,
      13316, 13272, 13228, 13183, 13139, 13094, 13050, 13005,
      12960, 12915, 12870, 12824, 12779, 12733, 12688, 12642,
      12596, 12550, 12504, 12457, 12411, 12364, 12317, 12270,
      12223, 12176, 12129, 12081, 12034, 11986, 11938, 11890,
      11841, 11793, 11744, 11695, 11646, 11597, 11548, 11499,
      11449, 11399, 11349, 11299, 11248, 11198, 11147, 11096,
      11045, 10994, 10942, 10890, 10838, 10786, 10734, 10681,
      10628, 10575, 10522, 10468, 10414, 10360, 10306, 10252,
      10197, 10142, 10087, 10031, 9975, 9919, 9863, 9806,
      9749, 9692, 9634, 9577, 9518, 9460, 9401, 9342,
      9283, 9223, 9163, 9102, 9041, 8980, 8918, 8856,
      8794, 8731, 8668, 8605, 8540, 8476, 8411, 8346,
      8280, 8213, 8147, 8079, 8011, 7943, 7874, 7805,
      7735, 7664, 7593, 7521, 7448, 7375, 7301, 7226,
      7151, 7075, 6998, 6921, 6842, 6763, 6683, 6601,
      6519, 6436, 6352, 6267, 6181, 6093, 6004, 5914,
      5823, 5731, 5636, 5541, 5444, 5345, 5244, 5141,
      5036, 4930, 4820, 4709, 4595, 4477, 4357, 4234,
      4107, 3976, 3840, 3700, 3554, 3402, 3243, 3077,
      2900, 2712, 2511, 2292, 2049, 1774, 1449, 1024,
      0
    };

    Num normalizeAngle(Num angle) {
      return angle - twoPi * Util::floor(angle*inverseTwoPi);
    }

    static const uint16_t trigTableFactor = 1 << (Config::numPrecision-Config::trigPrecision);
    static const Num inverseTrigTableFactor = Num::inverse(trigTableFactor);
    static const Num radiansToTrigTableRange = inverseTwoPi*inverseTrigTableFactor;

    Num sin(Num n) {
      const Num radians = normalizeAngle(n);
      const Num ratio = radians*radiansToTrigTableRange;
      return Num::createByRaw(sineTable[ratio.raw]);
    }

    Num cos(Num n) {
      const Num radians = normalizeAngle(n);
      const Num ratio = radians*radiansToTrigTableRange;
      return Num::createByRaw(cosineTable[ratio.raw]);
    }

    Num acos(Num n) {
      assert(n >= Num(-1) && n <= Num(1));
      const Fixie::Num ratio = Util::halve(n+Num(1))*inverseTrigTableFactor;
      return Num::createByRaw(arcCosineTable[ratio.raw]);
    }
  }
}
